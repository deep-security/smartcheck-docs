<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Deployment Guide | Deep Security Smart Check</title>
    <link rel="shortcut icon" href="favicon.ico" sizes="256x256" type="image/x-icon" />
    <link rel="icon" href="favicon.ico" sizes="256x256" type="image/x-icon" />
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <article class="main-container">
        <section>
	    <img src="../tm_logo.png" alt="Trend Micro logo">		
            <h1>Deep Security Smart Check Deployment Guide</h1>
            <p>Deep Security™ Smart Check is a container image scanner from Trend Micro™. This guide describes how Smart Check works and how to use the Smart Check console. It contains:</p>
            <ul>
                <li><a href="#about-smart-check" title="About Smart Check" target="_self">About Smart Check</a>                
                  <ul>
                    <li><a href="#dev-ops" title="How does Smart Check fit into a DevOps pipeline?" target="_self">How does Smart Check fit into a DevOps pipeline?</a></li>
                    <li><a href="#supported-registries" title="Supported registries" target="_self">Supported registries</a></li>
                    <li><a href="#system-requirements" title="System requirements" target="se">System requirements</a></li>
                  </ul>
                </li>
                <li><a href="#install" title="Install Smart Check" target="_self">Install Smart Check</a>
                  <ul>
                    <li><a href="#get-url" title="Get the URL of the Smart Check administrator console" target="_self">Get the URL of the Smart Check administrator console</a></li>
                    <li><a href="#get-default-user" title="Get the initial administrator user name and password" target="_self">Get the initial administrator user name and password</a></li>
					<li><a href="#outbound" title="Allow inbound and outbound connections" target="_self">Allow inbound and outbound connections</a></li>
                  </ul>
                </li>
                <li><a href="#first-steps" title="First steps" target="_self">First steps</a>
                  <ul>
                    <li><a href="#log-in" title="Log in to the Smart Check administrator console" target="_self">Log in to the Smart Check administrator console</a></li>
                    <li><a href="#configure-users" title="Configure Smart Check users" target="_self">Configure Smart Check users</a></li>
                    <li><a href="#registry" title="Add or edit a registry" target="_self">Add or edit a registry</a></li>
                    <li><a href="#start-scan" title="Start a scan" target="_self">Start a scan</a></li>
                    <li><a href="#get-results" title="See scan results" target="_self">See scan results</a></li>
                    <li><a href="#custom-content-rules" title="Add custom content rules" target="_self">Add custom content rules</a></li>
                  </ul>
                </li>
                <li><a href="#access-api" title="Access the API documentation" target="_self">Access the API documentation</a></li>
				<li><a href="#faq" title="Frequently asked questions" target="_self">Frequently asked questions</a></li>
				<li><a href="#outposts" title="Run Smart Check on AWS Outposts" target="_self">Run Smart Check on AWS Outposts</a></li>
				<li><a href="#sizing" title="Sizing guidelines" target="_self">Sizing guidelines</a>
					<ul>
						<li><a href="#sizing-summary" title="Summary and recommendations" target="_self">Summary and recommendations</a></li>
						<li><a href="#sizing-details" title="Details" target="_self">Details</a></li>
					</ul></li>
            </ul>
        </section>
        <section>
            <h2><a id="about-smart-check"></a>About Deep Security Smart Check</h2>
				<p>Deep Security™ Smart Check performs pre-runtime scans of Docker™ images, enabling you to fix issues before they reach the orchestration environment (for example, Kubernetes®). Deep Security Smart Check provides the ability to:</p>
				<ul>
				  <li>detect OS-level and application-level vulnerabilities</li>
				  <li>detect malware</li>
				  <li>detect secrets and keys embedded in your applications</li>
				  <li>perform custom scan queries to find suspicious or unwanted files</li>
				  <li>check image content against a compliance checklist that includes items from PCI-DSS, HIPAA, and NIST 800-190.</li>
		  </ul>
				<p>Deep Security Smart Check receives up-to-date threat data from private Trend Micro endpoints. Smart Check obtains malware information from the Trend Micro Smart Protection Network™ and detects threats using Trend Micro XGen™ machine learning algorithms. Deep Security Smart Check will find vulnerabilities in these Linux® distributions:</p>
				<ul>
				  <li>Red Hat® Enterprise Linux™</li>
				  <li>CentOS™</li>
					<li>Oracle® Linux</li>
					<li>Ubuntu®</li>
					<li>Debian®</li>
					<li>Alpine™</li>
					<li>Amazon™ Linux 2018.03 and Amazon Linux 2</li>
				</ul>
					<h3><a id="dev-ops"></a>How does Smart Check fit into a DevOps pipeline?</h3>
						<p>Deep Security Smart Check provides a valuable step in your continuous integration (CI) or continuous delivery (CD) pipeline.</p>
						<p>For example, Jenkins® projects can automatically build, test, and then push Docker images to a Docker registry. Once pushed, the image may be instantly available to run in an orchestration environment. If malware or vulnerabilities exist in the image, then they become a risk when the image is run. Since images are intended to be immutable, the right time to scan the image is when it's first pushed to the registry.</p>
						<p>That&rsquo;s where Deep Security Smart Check fits in – it can scan Docker images in any registry that implements the Docker Registry V2 API. All Deep Security Smart Check operations are available through a documented collection of APIs to simplify integration into your CI/CD pipeline. <a href="https://deep-security.github.io/smartcheck-docs/api/index.html" target="_blank" title="Deep Security Smart Check APIs">Deep Security Smart Check APIs</a> can be invoked automatically by your CI/CD system to start scans when an image is pushed to a Docker registry. Scan results are also available through the API. You can also scan images before they reach your production registry (see <a href="https://github.com/deep-security/smartcheck-helm/wiki/Configure-pre-registry-scanning" target="_blank" title="Configure pre registry scanning">Configure pre registry scanning</a> in the Smart Check wiki).</p>
						<p>The Smart Check API includes a web hook facility that allows CI/CD components to register to receive notifications of scan events, including ‘scan-completed’, allowing you to automate workflows. For example, a Docker image signing service could register to receive scan results and then use those results to decide whether a particular image should be digitally signed and promoted to a “blessed” repository that is available to your orchestration environment. You could also set a web hook to call a receiver service that forwards scan results to a Slack™ channel or ServiceNow™ account.</p>
						<p>Deep Security Smart Check also includes an administrator console that provides:</p>
				<ul>
					<li>a dashboard (system-wide summary of scan information, including metrics)</li>
					<li>user management</li>
					<li>registry configuration</li>
					<li>access to scan results</li>
					<li>scan history</li>
					<li>content rule customization</li>
				</ul>
			<h3><a id="supported-registries"></a>Supported registries</h3>
            <p>Deep Security Smart Check supports scanning Docker images in any registry that supports the Docker Registry V2 API and allows catalog listing. Tested registries include:</p>
            <ul>
                <li>Docker Trusted Registry (DTR)</li>
                <li>Google Container Registry (GCR)</li>
                <li>Amazon™ Elastic Container Registry (ECR)</li>
                <li>Azure™ Container Registry (ACR)</li>
                <li>VMware® Harbor</li>
                <li>jFrog™ Artifactory</li>
                <li>Sonatype Nexus™</li>
                <li>Quay™ Container Registry</li>
            </ul>
            <p><strong>Note: </strong>Deep Security Smart Check requires a TLS connection to the registry.</p>
            <p>To integrate Deep Security Smart Check into your pipeline, you may need to write integration logic to trigger scanning based on the event model of your registry. For example, Google Container Registry uses a pub/sub model to publish events about registry activity and Docker Trusted Registry uses a web hook model. If you use Jenkins, you can use the <a href="https://github.com/deep-security/smartcheck-plugin" target="_blank" title="Deep Security Smart Check plugin for Jenkins">Deep Security Smart Check plugin for Jenkins</a> for easy integration into your pipeline. You can also use our GitHub Action directly to integrate Smart Check into your CI workflows. See <a href="https://github.com/deep-security/smartcheck-scan-action" target="_blank" title="Deep Security Smart Check Scan Action">Deep Security Smart Check Scan Action</a> for details. </p>
            <h3><a id="system-requirements"></a>System requirements</h3>
            <p>This release of Deep Security Smart Check requires:</p>
            <ul>
              <li>Kubernetes 1.10.0 or greater on a Kubernetes Certified platform (or equivalent). See <a href="https://www.cncf.io/certification/software-conformance/" target="_blank" title="Software Conformance - Cloud Native Computing Foundation">https://www.cncf.io/certification/software-conformance/</a></li>
              <li>Helm/Tiller 2.14.1 or greater</li>
              <li>Google Chrome™ browser to access the Smart Check administrator console. Other modern browsers may work with Smart Check but are not officially supported.</li>
            </ul>
			<p>Deep Security Smart Check is tested with Google Kubernetes Engine, using the following resource allocations:</p>
			<ul>
			<li>1 manager node and 4 worker nodes</li>
			<li>Each node is an "n1-standard-2" machine type, with:
				<ul>
					<li>2 vCPUs</li>
					<li>5 GB RAM</li>
				</ul>
			</li>
			</ul>
			<p>By default, Deep Security Smart Check requires an 8 GB persistent volume when using the built-in database. If you install using an external database, Deep Security Smart Check does not require any persistent volumes.</p>
			<p>You can also <a href="#outposts" title="Run Smart check on AWS Outposts" target="_self">run Smart Check on AWS Outposts</a>.</p>
			<p>For additional information about scaling and sizing your Smart Check cluster, see <a href="#sizing" title="Sizing guidelines" target="_self">Sizing guidelines</a></p>
        </section>
        <section>
            <h2><a id="install"></a>Install Deep Security Smart Check</h2>
            <p>Deep Security Smart Check is supported on the Kubernetes platform and uses the Helm package manager for Kubernetes. You must have a running Kubernetes cluster in order to deploy Smart Check.</p>
            <p>See the Deep Security Smart Check readme for up-to-date instructions on how to install Deep Security Smart Check: <a href="https://github.com/deep-security/smartcheck-helm" target="_blank" title="https://github.com/deep-security/smartcheck-helm">https://github.com/deep-security/smartcheck-helm</a>. By default, the Helm deployment retrieves the Smart Check Docker images from DockerHub: <a href="https://hub.docker.com/r/deepsecurity/" target="_blank" title="https://hub.docker.com/r/deepsecurity/">https://hub.docker.com/r/deepsecurity/</a>.</p>
            <p>At the end of the install, you&rsquo;ll see commands that enable you to get the URL of the Smart Check administrator console and to get the initial administrator user name and password. The commands are also provided in the sections below.</p>
            <h3><a id="get-url"></a>Get the URL of the Smart Check administrator console</h3>
            <p>To get the URL of the Smart Check administrator console, configure <code>kubectl</code> with your cluster credentials and run these commands:</p>
            <p><code>$ export SERVICE_IP=$(kubectl get svc proxy –o jsonpath='{.status.loadBalancer.ingress[0].ip}')</code></p>
            <p><code>$ echo https://$SERVICE_IP:443</code></p>
            <h3><a id="get-default-user"></a>Get the initial administrator user name and password</h3>
            <p>To get the user name and password that you will use to log in to the Smart Check application for the first time, configure <code>kubectl</code> with your cluster credentials and run these commands:</p>
            <p><code>$ echo Username: $(kubectl get secrets -o jsonpath='{ .data.userName }' deepsecurity-smartcheck-auth | base64 --decode)</code></p>
            <p><code>$ echo Password: $(kubectl get secrets -o jsonpath='{ .data.password }' deepsecurity-smartcheck-auth | base64 --decode)</code></p>
			<h3><a id="outbound"></a>Allow inbound and outbound connections</h3>
			<p>If you are using an HTTP proxy, Smart Check requires that you open one <strong>inbound</strong> port  for HTTPS access to the proxy service. Details for determining the port information are provided during the Smart Check installation. </p>
			<p>Smart Check also requires <strong>outbound</strong> access to these hosts over HTTPS (port 443): </p>
			<ul>
			  <li><strong>Vulnerabilities: </strong>dstf.trendmicro.com:443</li>
				<li><strong>License server: </strong>licenseupdate.trendmicro.com:443</li>
				<li><strong>Trend Micro Smart Protection Network: </strong> *.trx.trendmicro.com:443</li>
				<li><strong>Trend Micro Smart Scan Service: </strong>*.icrc.trendmicro.com:443</li>
				<li><strong>Malware patterns: </strong>ipv6-iaus.trendmicro.com:443</li>
				<li><strong>Target registries</strong> (for example,  GCR, on-premises DTR, ECR, etc.). Note that registries must support TLS for Deep Security Smart Check to connect to them.</li>
				<li><strong>Web hook targets</strong></li>
				<li><strong>Identity provider for metadata</strong> if you have configured SAML for single sign-on</li>
				<li><strong>Telemetry: </strong>telemetry.deepsecurity.trendmicro.com:443</li>
	        </ul>
        </section>
        <section>
            <h2><a id="first-steps"></a>First steps after installation</h2>
            <p>After installing Smart Check:</p>
            <ol>
                    <li><a href="#log-in" title="Log in to the Smart Check administrator console" target="_self">Log in to the Smart Check administrator console</a></li>
                    <li><a href="#configure-users" title="Configure Smart Check users" target="_self">Configure Smart Check users</a></li>
                    <li><a href="#registry" title="Add or edit a registry" target="_self">Add or edit a registry</a></li>
                    <li><a href="#start-scan" title="Start a scan" target="_self">Start a scan</a></li>
            </ol>
            <h3><a id="log-in"></a>Log in to the Smart Check administrator console</h3>
            <ol>
                <li>Go to the URL provided at the end of the installation. If you don&rsquo;t have the URL, see <a href="#get-url">Get the URL of the Smart Check administrator console</a>.</li>
                <li>Enter the initial administrator username and password and click <strong>LOGIN</strong>. If you don't have the user credentials, see <a href="#get-default-user">Get the initial administrator user name and password</a>.</li>
            </ol>
            <p>The Deep Security Smart Check administrator console appears.</p>
            <p>The first time you log in, you are prompted to change the password for the default administrator.</p>
            <h3><a id="configure-users"></a>Configure Smart Check users</h3>
            <p>Deep Security Smart Check has a default administrator account, but you can add other user accounts.</p>
            <p><strong>Tip: </strong>You can also enable SAML single sign-on in Deep Security Smart Check, so that users in your organization can sign in to Smart Check with their existing organization account. You can also use your identity provider to implement user authentication access control features like password strength or change enforcement,&nbsp; one-time passwords (OTP), and&nbsp; two-factor or multi-factor authentication (2FA / MFA). For instructions, see <a>Implement SAML single sign-on</a> on the Smart Check helm wiki.</p>
            <h4><a id="add-user"></a>Add or edit a user</h4>
            <ol>
                <li>On the left side of the Smart Check administrator console, click <img src="images/icon-users.png" alt="User icon"/> <strong>Users</strong>.</li>
                <li>On the Users page, click <strong>+ CREATE</strong> to add a user or click an existing user to edit.</li>
                <li>On the Add/Edit User page, enter the <strong>User ID</strong> that the user will use to log in to Deep Security Smart Check. The User ID has a maximum of 64 characters.</li>
                <li>Enter the user&rsquo;s full name.</li>
                <li>Enter a password and confirm the password. </li>
                <li>We recommend that you select <strong>Require user to change password on next login</strong> when adding a new user. </li>
                <li>Select a role to assign to the user. Smart Check has three types of roles:
                    <ul>
                        <li><strong>Administrator: </strong>Full control</li>
                        <li><strong>User: </strong>Can request scans and has read-only access to users, roles, registries, content rules, identity providers, and overrides.</li>
                        <li><strong>Auditor: </strong>Read-only access</li>
                    </ul>
                </li>
                <li>Click <strong>SAVE</strong>.</li>
            </ol>
            <h4><a id="delete-user"></a>Delete a user</h4>
            <ol>
                <li>On the left side of the Smart Check administrator console, click <img src="images/icon-users.png" alt="User icon"/> <strong>Users</strong>.</li>
                <li>On the Users page, click the user you want to remove.</li>
                <li>On the Edit User page, click <strong>DELETE</strong>.</li>
            </ol>
            <p><strong>Note: </strong>You must have at least one user with the administrator role. If you have only one administrator, you cannot delete that user until you add another administrator.</p>
            <h3><a id="registry"></a>Add or edit a registry</h3>
            <p>Before Smart Check can scan your images, it needs to know which registries contain the images that you want to scan. You can add one or more registries (up to a maximum of 4 with a trial or basic license) to Deep Security Smart Check.</p>
            <h4><a id="before-registry"></a>Before adding a registry</h4>
            <p>When you add a registry, you must provide authentication credentials that Deep Security Smart Check will use to access your repository. Depending on the type of registry, you can provide AWS credentials,  a username and password, or a JSON key file.</p>
            <p>If you are using Google Cloud Registry, create a service account and use its JSON key file. The service account must have at least the <strong>Storage Object Viewer </strong> role and both the <strong>Google Cloud Resource Manager API</strong> and <strong>Google Container Registry API</strong> must be enabled. Google provides <a href="https://cloud.google.com/container-registry/docs/advanced-authentication" target="_blank" title="Advanced Authentication Methods">an overview</a> and <a href="https://support.google.com/cloud/answer/6158849#serviceaccounts" target="_blank" title="Service accounts">detailed instructions</a> for creating service accounts.</p>
            <h4><a id="add-registry"></a>Add a registry</h4>
            <ol>
                <li>On the left side of the Smart Check administrator console, click <img src="images/icon-registries.png" alt="Registries icon"/> <strong>Registries</strong>.</li>
                <li>Click <strong> + CREATE </strong>to add a registry.</li>
                <li>On the Create Registry page, in the <strong>Name</strong> field, enter a descriptive name for the registry. This name does not necessarily need to match the namespace of your Docker registry. If you plan to add multiple registries, you’ll use this name to tell them apart in the Smart Check administrator console. The name should be short but meaningful, with a maximum of 256 characters.</li>
                <li>In the <strong>Description</strong> field, enter an optional description of the registry. This is useful if you need to capture a bit more information than the Name field allows.</li>
                <li>In the <strong>Registry Type</strong> field, select the type of registry you're adding:
			<ul>
				<li>Google Cloud Registry</li>
				<li>Amazon Elastic Cloud Registry</li>
				<li>Generic Registry</li>
			</ul>
		</li>
		<li>For a Google Cloud Registry, enter:
			<ul>
				<li><strong>Registry Host: </strong>Hostname or IP address of the Docker registry you want to scan</li>
				<li><strong>JSON key file: </strong>JSON key that Smart Check will use to access your repository</li>
			</ul>
		</li>
		<li>For an Amazon Elastic Cloud Registry, enter:
			<ul>
				<li><strong>Region: </strong>AWS region identifier where your registry it located</li>
				<li><strong>Registry ID: </strong> (Optional) If you want to scan a registry in another account, enter the account ID here. If you do not specify an account, Smart Check will use the default registry.</li>
				<li><strong>Use cross-account role: </strong>Select this option if you want to scan a registry in another account. </li>
				<li><strong>Authentication method: </strong> Select either <strong>Instance Role</strong> or <strong>Access Key ID &amp; Secret</strong>. Specifying access keys is discouraged because the keys need to be updated periodically (for security reasons), which creates management overhead. </li>
			</ul>
		</li>
		<li>For a Generic Registry, enter:
			<ul>
				<li><strong>Registry Host: </strong>Hostname or IP address of the Docker registry you want to scan</li>
				<li><strong>Registry User: </strong>Username that Smart Check will use to access your repository</li>
				<li><strong>Password: </strong>Password that Smart Check will use to access your repository</li>
				<li><strong>HTTPS Configuration:</strong>
					<ul>
						<li><strong>Skip registry certificate validation (insecure): </strong>By default, Smart Check validates the TLS certificate associated with your registry. This validation requires that Smart Check trust the certificate of the CA that issued the registry certificate. If you don&rsquo;t have the CA certificate, you can select <strong>Skip registry certificate validation (insecure)</strong>.</li>
						<li><strong>Trust: </strong>Deep Security Smart Check has a built-in set of certificate authorities that it trusts. If your registry has a certificate that was issued by a well-known certificate authority, then you should not need to do anything for Smart Check to trust your registry. If the registry certificate was issued by a private certificate authority, you can upload the certificate authority's certificate (.pem file).</li>
					</ul>
				</li>
			</ul>
		   </li>
           <li>If <strong>Start scan when registry is created</strong> is selected, a scan  starts as soon as you click <strong>Create Registry</strong>. </li>
           <li>If  <strong>Perform scan periodically</strong> is selected, Smart Check automatically performs a scan every day at midnight UTC.</li>
           <li>Click <strong>+ ADD FILTER</strong> to include or exclude images based on any segment of their fully qualified name in the form <code>&lt;repository&gt;/&lt;image&gt;:&lt;tag&gt;</code>. For example, the include filter <code>*latest*</code> would match <code>smartcheck/scan:latest</code> and <code>smartcheck/auth:latest</code>. The default include filter of <code>*</code> will select all images in the registry.</li>
           <li>Click <strong>CREATE REGISTRY</strong>.</li>
           </ol>
            <p>To edit a registry, go to the Registries page, click the registry, and then click <img src="images/icon-edit.png" alt="Edit icon"/>.</p>
            <p>To refresh the list of images in a registry, go to the Registries page, click the registry, and then click <img src="images/icon-sync.png" alt="Sync icon"/>.</p>
            <h3><a id="start-scan"></a>Start a scan</h3>
            <p>When Smart Check receives a scan request, it pulls the image(s) specified in the registry being scanned, unpacks each layer, and inspects the content for malware, vulnerabilities, secrets and keys, and compliance problems.</p>
            <p>There are several ways that a  scan can be triggered:</p>
            <ul>
                <li>Smart Check automatically starts a scan at midnight UTC for all registries that have been created with the<strong> Perform scan periodically</strong> option selected.</li>
                <li>You can manually start a scan by clicking the <strong>Scan Now</strong> button. (Instructions are below)</li>
                <li>You can start a scan through the Smart Check API. You can access the API documentation from the menu in the Smart Check administrator console.</li>
            </ul>
            <h4><a id="sc-manual-scan"></a>Manually start a scan</h4>
            <ol>
              <li>In the Registries section of the <img src="images/icon-dashboard.png" alt="Dashboard icon"/> <strong>Dashboard</strong> page or on the <img src="images/icon-registries.png" alt="Registries icon"/> <strong>Registries</strong> page, click the name of the registry that you want to scan.</li>
              <li>Click <img src="images/icon-scan-now.png" alt="Scan now icon"/>.</li>
                <li>A confirmation message appears. Click <strong>OK</strong>.</li>
            </ol>
            <p>To confirm that scans are running, on the left side of the Smart Check administrator console, click <img src="images/icon-scans.png" alt="Scans icon"/> <strong>Scans</strong>. Running scans have a spinning icon next to them.</p>
            <h3><a id="get-results"></a>See scan results</h3>
            <p>There are several ways to get scan results:</p>
            <ul>
              <li>You can add a web hook through the Smart Check API with a destination URL that is called automatically when results are ready. See the <a href="https://deep-security.github.io/smartcheck-docs/api/index.html">API documentation</a> for details. Your web hook receiver could, for example, process the scan result and forward a notification to Slack or ServiceNow if appropriate.</li>
              <li>You can request the results directly through the Smart Check API. For details, refer to the <a href="https://deep-security.github.io/smartcheck-docs/api/index.html">API documentation</a>.</li>
              <li>You can check the scan results in the Smart Check administrator console:
                    <p>In the Registries section of the <img src="images/icon-dashboard.png" alt="Dashboard icon"/> <strong>Dashboard</strong> page or on the <img src="images/icon-registries.png" alt="Registries icon"/> <strong>Registries</strong> page, click the registry. You’ll see a summary that includes information about the findings from the latest scan.</p>
					<p>You'll also see a searchable list of images in the registry. To see specific information about an individual image, click the image to display its scan history. Click a scan to display information about it.</p>
                </li>
            </ul>
	        <h3><a id="custom-content-rules"></a>Add custom content rules</h3>
            <p>Deep Security Smart Check ships with a built-in collection of rules that detect some common items that should never be included in images. You can also write your own rules, using the YARA language. For information on writing rules, see <a href="https://github.com/deep-security/smartcheck-helm/wiki/Create-custom-content-rules">Create custom content rules</a> in the Smart Check wiki.</p>
			<p>Individual rules are bundled into rulesets, and rulesets are grouped in collections. Deep Security Smart Check can have only one active collection at a time, so you can either add new rulesets to the default Deep Security Smart Check Collection, or create a new collection to use instead. Within a collection, you can enable or disable individual rulesets.</p>
			<p>You can use the <a href="https://deep-security.github.io/smartcheck-docs/api/index.html">API</a> or the UI to manage collections and rulesets. The UI is described in the following sections.</p>
			<h3>Create a new content ruleset collection</h3>
			<p>If you don't want to use the built-in Deep Security Smart Check Collection, you can make your own collection.</p>
			<ol>
               <li>On the left side of the Smart Check administrator console, click <img src="images/icon-content-rule.png" alt="Content rule icon"/> <strong>Content Rules</strong>.</li>
                <li>On the Content Rules page, click <strong>+ CREATE</strong></li>
                <li>In the pop-up that appears, enter a name for the new collection and click <strong>ADD</strong>. A new, empty ruleset collection appears on the Content Rules page.</li>
				<li>Add some rulesets to the collection, and enable those rulesets</li>
				<li>When you're ready to being using the new collection, click <img src="images/icon-activate.png" alt="Activate icon"/> to activate the collection. This also deactivates any other collections.</li>
			</ol>	
			<h3>Change the name of a content ruleset collection</h3>
			<ol>
			   <li>On the Content Rules page, click <img src="images/icon-edit.png" alt="Edit icon"/> for the ruleset collection that you want to rename.</li>
			   <li>In the pop-up that appears, edit the name and click <strong>UPDATE</strong>. </li>
			</ol>	
			<h3>Add rulesets to a collection</h3>
			<ol>
               <li>On Content Rules page, click <img src="images/icon-add.png" alt="Add icon"/> in the ruleset collection where you want to add the ruleset.</li>
			   <li>In the pop-up that appears:
					<ol>
						<li>Enter a name for the ruleset.</li>
						<li>The ruleset is enabled by default, or you can slide the toggle to disable it.</li>
						<li>Add the rule files by dragging and dropping them or clicking in the area provided. Files can be a maximum of 8 KB.</li>
						<li>Click <strong>ADD</strong>.</li>
					</ol>
				</li>
			</ol>
        </section>
        <section>
            <h2><a id="access-api"></a>Access the API documentation</h2>
            <p>Everything you can do in the Smart Check administrator console (and more) is available as an API operation. You can use the API and web hooks to integrate Deep Security Smart Check with a variety of other products.</p>
            <p>You can find the API documentation in the Smart Check administrator console. On the left side of the console, click <img src="images/icon-api.png" alt="API icon"/><strong> API Documentation</strong>.</p>
			<p>Or go to <a href="https://deep-security.github.io/smartcheck-docs/api/index.html" target="_blank" title="Deep Security Smart Check APIs"> https://deep-security.github.io/smartcheck-docs/api/index.html</a>.</p>
        </section>
		<section>
            <h2><a id="faq"></a>Frequently asked questions</h2>
            <p><strong>Does Smart Check only find vulnerabilities in packages that are installed with a package manager?</strong></p>
			<p style="margin-left: 40px">Smart Check scans both the installed package list as well as a set of applications commonly installed by copying them directly to the file system. Our labs team provides an active feed with up-to-date information about the supported applications.</p>
            <p><strong>Does Smart Check get automatic security updates, or do I need to upgrade to get security updates?</strong></p>
			<p style="margin-left: 40px">Deep Security Smart Check updates its malware details and vulnerability definitions automatically. You will need to upgrade to get software updates, including new feature and security updates.</p>
			<p><strong>How do I scan images before they reach my production registry?</strong></p>
			<p style="margin-left: 40px">See <a href="https://github.com/deep-security/smartcheck-helm/wiki/Configure-pre-registry-scanning" target="_blank" title="Configure pre registry scanning">Configure pre registry scanning</a> in the Smart Check wiki for instructions.</p>
			<p><strong>How do I override a vulnerability or content scan finding?</strong></p>
			<p style="margin-left: 40px">If a scan finds a vulnerability or content scan issue but you know it's not a concern, you can override it using the Smart Check API. For details, see the <a href="https://deep-security.github.io/smartcheck-docs/api/index.html#tag/Overrides" target="_blank" title="Overrides">Overrides section of the API</a>. </p>
			<p><strong>How do I check whether images meet common PCI-DSS compliance requirements?</strong></p>
			<p style="margin-left: 40px">You can use the checklist feature in the Smart Check API to verify whether a scanned image complies with common PCI requirements. The checklist feature is currently supported for <strong>CentOS</strong> and <strong>Red Hat</strong> images only. For details, see the <a href="https://deep-security.github.io/smartcheck-docs/api/index.html#tag/Scans" target="_blank" title="Scans">Scans section of the API</a>.</p>
			<p><strong>How do I use an external database with Smart Check?</strong></p>
			<p style="margin-left: 40px">By default, Deep Security Smart Check configures a database pod in your Kubernetes cluster. This is convenient for demonstration purposes, but for production you should use an external database. For instructions, see <a href="https://github.com/deep-security/smartcheck-helm/wiki/Use-an-external-database" target="_blank" title="Use an external database">Use an external database</a> in the Smart Check wiki.</p>
			<p><strong>How do I replace the self-signed Smart Check service certificate?</strong></p>
			<p style="margin-left: 40px">See <a href="https://github.com/deep-security/smartcheck-helm/wiki/Replace-the-service-certificate" target="_blank" title="Replace the service certificate">Replace the service certificate</a> in the Smart Check wiki for instructions.</p>
			<p><strong>How do I secure Smart Check web hooks?</strong></p>
			<p style="margin-left: 40px">See <a href="https://github.com/deep-security/smartcheck-helm/wiki/Secure-web-hooks" target="_blank" title="Secure web hooks">Secure web hooks</a> in the Smart Check wiki for instructions.</p>
			<p><strong>I'm locked out! How do I recover my administrator account?</strong></p>
			<p style="margin-left: 40px">See <a href="https://github.com/deep-security/smartcheck-helm/wiki/Re-create-an-administrator-user" target="_blank" title="Re create an administrator user">Recreate an administrator user</a> in the Smart Check wiki for instructions.</p>
        </section>
		<section>
			<h2><a id="outposts"></a>Run Smart Check on AWS Outposts</h2>
			<p><a href="https://aws.amazon.com/outposts/" target="_blank" title="AWS Outposts">AWS Outposts</a> enables you to run an AWS environment in a datacenter or other on-premises location. You can deploy Smart Check on an EKS cluster running on AWS Outposts, using either a built-in database (for testing) or an external RDS instance that's running on AWS Outposts (for production). Smart Check on AWS Outposts is identical to Smart Check in the AWS cloud environment. Smart Check does not currently support high availability. </p>
		</section>
        <section>
            <h2><a id="sizing"></a>Sizing guidelines</h2>
			<p>This section provides guidance on sizing your Smart Check cluster. Smart Check can be scaled either vertically (adding more CPU and memory) or horizontally (adding more worker-nodes to the cluster).</p>
			<h3><a id="sizing-summary"></a>Summary and recommendations</h3>
			<p>Our testing revealed that scaling vertically produces faster scan rates than scaling horizontally. For example, deploying Deep Security Smart Check using 4 worker-nodes of m5a-xlarge instances resulted in a faster scan rate than using 8 worker-nodes of m5-large instances.</p>
			<p>To get the best performance per dollar spent, we recommend that you scale your pods until you see a high CPU or memory utilization (See <a href="#scale" title="Scale Smart Check pods" target="_self">Scale Smart Check pods</a>). As shown in <a href="#scale-results" title="Pod scaling results" target="_self">Pod scaling results</a>, we found that CPU utilization will cap before memory does, so you might consider increasing the CPUs in a custom EC2 instance, rather than just upgrading from m5-large to m5a-xlarge (which would increase both CPUs and memory).</p>
			<p>We also tested Smart Check with Amazon RDS to identify the impact that Smart Check has on database
resources. Our testing showed that there is no major impact on the RDS database during scans.</p>
			<p>Details about how we reached these conclusions are provided below.</p>
			<h3><a id="sizing-details"></a>Details</h3>
			<p>This section provides details on how we reached the conclusions in the "Summary and recommendations" section.</p>
			<h4>Test environment</h4>
			<p><strong>Cluster configuration</strong></p>
<p>We used these cluster configurations for our testing:</p>
			<table>
				<col />
				<col />
				<col />
				<col />
				<col />
				<col />
				<thead>
					<tr>
						<th>Cluster configuration</th>
						<th>Cluster name</th>
						<th>Nodes</th>
						<th>Instance type</th>
						<th>Total vCPUs in cluster</th>
						<th>Total memory in cluster</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Baseline configuration</td>
						<td>sc-d-4</td>
						<td>4</td>
						<td>m5-large (2 CPU, 8 GB)</td>
						<td>8</td>
						<td>32 GB</td>
					</tr>
					<tr>
						<td>Horizontal scaling</td>
						<td>sc-d-8</td>
						<td>8</td>
						<td>m5-large (2 CPU, 8 GB)</td>
						<td>16</td>
						<td>64 GB</td>
					</tr>
					<tr>
						<td>Vertical scaling</td>
						<td>sc-xl-4</td>
						<td>4</td>
						<td>m5a-xlarge (4 CPU, 16 GB)</td>
						<td>16</td>
						<td>64 GB</td>
					</tr>
					<tr>
						<td>Horizontal and vertical scaling</td>
						<td>sc-xl-8</td>
						<td>8</td>
						<td>m5a-xlarge (4 CPU, 16 GB)</td>
						<td>32</td>
						<td>128 GB </td>
					</tr>
				</tbody>
			</table>
			<p>Because AWS instance types may change over time, here are the specifications for  m5-large and m5a-xlarge instances at the time of our testing:</p>
			<table>
				<col />
				<col />
				<col />
				<thead>
					<tr>
						<th>Specification</th>
						<th>m5-large</th>
						<th>m5a-xlarge</th>
					</tr>
				</thead>
				<tbody>
				  <tr>
					<td>Processor type</td>
						<td>1st or 2nd generation Intel Xeon Platinum 8000 series</td>
						<td>AMD EPYC 7000 series</td>
					</tr>
					<tr>
						<td>Clock speed</td>
						<td>Turbo Clock speed upto 3.1 GHz</td>
						<td>Turbo Clock speed upto 2.5 GHz</td>
					</tr>
					<tr>
						<td>Advanced Vector Extension Support</td>
						<td>Yes. 512 (AVX-512) instruction set. Two times FLOPS per core compared to m4 instances.</td>
						<td>No</td>
					</tr>
					<tr>
					  <td>Memory</td>
					  <td>8 GB</td>
					  <td>16 GB</td>
				  </tr>
					<tr>
					  <td>Instance Storage</td>
					  <td>EBS-only</td>
					  <td>EBS-only</td>
				  </tr>
					<tr>
					  <td>Network Bandwidth</td>
					  <td>Up to 10 Gbps</td>
					  <td>Up to 10 Gbps</td>
				  </tr>
					<tr>
						<td>EBS Bandwidth</td>
						<td>Up to 4750 Mbps</td>
						<td>Up to 2880 Mbps</td>
				  </tr>
				</tbody>
			</table>
			<h5>Registry configuration</h5>
<p>We used this registry configuration for our testing:</p>
<table>
		<col />
		<col />
		<col />
		<thead>
			<tr>
				<th>Registry size</th>
				<th>Total images</th>
				<th>Average image size</th>
		    </tr>
	    </thead>
		<tbody>
			<tr>
				<td>11.949 GB</td>
				<td>43</td>
				<td>284.5 MB</td>
		    </tr>
	    </tbody>
	  </table>
			<h5>Database configuration</h5>
		  <p>We used a t2.small RDS instance for each of the EKS instances, and our testing showed that there is no major impact on the RDS database during scans.</p>
		  <p>Because Amazon RDS types may change over time, here are the specifications for a t2.small instance at the time of our testing:</p>
		<ul>
		  <li><strong>Core:</strong> 1</li>
		  <li><strong>vCPU:</strong> 1</li>
		  <li><strong>CPU credits/hour:</strong> 12</li>
		  <li><strong>Memory:</strong> 2 GB</li>
		  <li><strong>Network performance (Gbps):</strong> Low to moderate</li>
			</ul>
<h4>Cluster resource utilization</h4>
				<img src="images/average-cluster-cpu-chart.png" alt="Chart showing average cluster CPU utilization"/>
				<img src="images/average-cluster-memory-chart.png" alt="Chart showing average cluster memory utilization"/>
			<h4><a id="scale"></a>Scale Smart Check pods</h4>
			<p>You can use the overrides.yaml file to specify the replica count for each pod:</p>
			<ol>
			<li>Add the following snippet to your <code>overrides.yaml</code> file:
<p class="code">replicas<br>
  malwareScan: 5<br>
  scan: 5<br>
  imageScan: 5<br>
  vulnerabilityScan: 5<br>
  contentScan: 5</p>
			</li>
			<li>Then, in your terminal, run:
			<p class="code">helm upgrade --values /path/to/overrides.yaml &lt;release-name&gt; /path/to/smartcheck-helm/</p>
			</li>
			</ol>
			<p>Using our default configuration (m5.large with 4 nodes), scaling each pod to a replica count of 5 resulted in an average CPU utilization of approximately 72%. That means you could potentially configure a replica count higher than 5.</p>
			<p>Scaling the pods linearly (all counts at 5 instead of different numbers) is a good approach if you’re not sure what kind of content findings your images typically have. But, for example, if your content findings consist mostly of malware, you could scale your malware pod's replica count to a larger number.</p>
			<p><b>Tip: </b>If the vulnerability scan pods become evicted, it’s usually because there is not enough room for them on the disk. To allocate more space for them, add the following to overrides.yaml:</p>
			<p class="code">vulnerabilityScan:<br>
  workVolume:<br>
    ## The amount of space to request for the vulnerability scan working volume<br>
    ##<br>
    ## Default value: 3Gi<br>
    sizeLimit: 4Gi</p>
			<h4><a id="scale-results"></a>Pod scaling results</h4>
			<p>This section details our test results with caching disabled. By default, caching is enabled for Smart Check, so actual performance in most environments should be higher than this.</p>
			<p>In the results below, R1, R2, R3 are replica counts.</p>
			<p>Each scan was pushed 10 times (10 iterations with one hour break). The results were:</p>
			<ul>
			<li><b>sc-d-4:</b> Scan rate for R3 is <b>130%</b> faster than R1, and R5 is <b>152%</b> faster than R1</li>
			<li><b>sc-d-8:</b> Scan rate for R3 is <b>135%</b> faster than R1, and R5 is <b>237%</b> faster than R1</li>
			<li><b>sc-xl-4:</b> Scan rate for R3 is <b>82%</b> faster than R1, and R5 is <b>144%</b> faster than R1</li>
			<li><b>sc-xl-8:</b> Scan rate for R3 is <b>90%</b> faster than R1, and R5 is <b>161%</b> faster than R1 </li>
	
			</ul>
			<img src="images/average-scan-rate.png" alt="Chart showing average scan rate comparison"/>
			<img src="images/average-memory-use.png"  alt="Chart showing average memory usage comparison"/>
			<img src="images/average-cpu-use.png"  alt="Chart showing average CPU usage comparison"/>
			<img src="images/scalability-improvement-factor.png"  alt="Chart comparing amounts of improvement"/>
			<p>Assuming R1 (replica count of 1) is the baseline (i.e. improvement factor 1:1 if comparing it to itself):
			<ul>
			<li>Scaling to R3 provides an improvement factor of at least 1.82 times to 2.3 when compared to R1.</li>
			<li>Scaling to R5 provides an improvement factor of a least 2.44 to 3.37 when compared to R1.</li>
			</ul>
			<p>When we increased the pod replica count within the same cluster configuration, we saw significant improvement to the scan rate while using very little additional resources (CPU and memory). </p>
	  </section>
    </article>
</body>
</html>
